<!doctype html>
<html>
 <head><title>Eden</title>
  <link rel='icon' type='image/png' href='./core/resources/icon.png' />
  <script src='./core/extlib/jquery-3.1.1.js'></script>
  <script src='./core/extlib/jquery-ui.min.js'></script>
  <script src='./core/extlib/fastdom.js'></script>
  <script src='./core/extlib/keypress.js'></script>
  <script src='./core/extlib/gistachio.js'></script>
  <script src='./core/extlib/axios.min.js'></script>
  <script src="https://unpkg.com/github-api/dist/GitHub.bundle.min.js"></script>
  <script type="text/plain" src="https://gist.githubusercontent.com/willxyu/007443bac03297484cfccd78ba3aa095/raw/1645ea27a99ddddd2b7ec6bdbc3e400ae2664f41/ndb.main.js"></script>
  <!-- <script src="https://rawgit.com/willxyu/007443bac03297484cfccd78ba3aa095/raw/1645ea27a99ddddd2b7ec6bdbc3e400ae2664f41/ndb.main.js"></script> -->
  <!-- <script src="https://gist.github.com/willxyu/007443bac03297484cfccd78ba3aa095"></script> -->
 </head>
 <body>
  <div id='container'>
   <div id='addenda' class='hidden'></div>
   <div id='output'>
<input type="file" id="files" name="files[]" multiple />
<output id="list"></output></div>
   <div id='panel'>
    <textarea id='input'></textarea>
    <div id='reload' onclick='reload()'></div>
    <a href="https://github.com/login/oauth/authorize?client_id=6e13bece29ffd812bb17&scope=gist" id='github' onclick=''></a>
    <div id='performance'></div>
    <div id='ping'></div>
   </div>
  </div>
 </body>
 <script src='./core/jsJS.js'></script>
 <script>
   var input = $('#input')
   var output = $('#output')
   var kp = kp || {}

   var log = console.log
   var getID = document.getElementById

  // test URL
  var token
  var url = window.location.href
  if (url.match(/\?code\=[a-z0-9]{20,20}$/i)) {
    var c = url.replace(/.*?\?code\=/,'')
    // exchange this code for access token
    var uri  = 'https://cors-anywhere.herokuapp.com/'
        uri += 'https://github.com/login/oauth/access_token'
        uri += '?client_id=6e13bece29ffd812bb17&'
        uri += 'client_secret=c377bb5f163d235ca37b3c656fe10f19b085caea&'
        uri += 'code=' + c
    $.ajax({
     type: 'POST',
     url : uri,
     success: function(data) {
       var RE    = /access_token=(.*?)&/g
       var match = RE.exec(data)
           token = match[1]
       console.log(token)
       // request GISTS
       if (typeof token !== 'undefined') {
        $.ajax({
          type: 'GET',
          url : 'https://api.github.com/gists?access_token='+token,
          success: function(m) {
            console.log(m)
          }
        })
       }
     },
    })
  }

  $(window).on('load', function() {
   if (jm) { 
    jm.init()
    jm.draw()
    jm.ready() }
    // keypress.js
    kp = new window.keypress.Listener()
    kp.simple_combo('ctrl d', kb.ctrl_d)
    kp.simple_combo('ctrl s', kb.ctrl_s)
    kp.simple_combo('ctrl p', kb.ctrl_p)
    kp.simple_combo('ctrl f', kb.ctrl_f)
    kp.simple_combo('ctrl r', kb.ctrl_r)
    kp.simple_combo('ctrl e', kb.ctrl_e)
    kp.simple_combo('ctrl l', kb.ctrl_l)
    kp.simple_combo('ctrl k', kb.ctrl_k)
    kp.simple_combo('ctrl .', kb.ctrl_dot)
    $(document).on('mousewheel', jm.sbHandler )
    $(document).on(  'dblclick', jm.dblHandler)
  })
  
  /*
  $.ajax({
   url: 'https://gist.githubusercontent.com/willxyu/007443bac03297484cfccd78ba3aa095/raw/1645ea27a99ddddd2b7ec6bdbc3e400ae2664f41/ndb.main.js',
   complete: function(a) {
     var s
     var t = a.responseText
     try {
       s = eval(t)
       console.log('Successful eval.')
     } catch(err) {
       console.log(err)
     }
     console.log(s)
   }
  })
  */
  
  /*
  $('#github').on('click', function() {
    console.log('aaa')
    $.ajax({
      url: 'https://cors-anywhere.herokuapp.com/https://github.com/login/oauth/authorize?client_id=b1b61eb74810488f2135&scope=gist',
      complete: function(data) {
        var b = JSON.parse(data.responseText)
        console.log(b)
      }
    })
  })*/
  // 
 </script>
</html>

<!--
  Things to do:

   clickable links
   fix gmcp
   manage PROMPT as raiseEvent / registerEvent
   manage GMCP as raiseEvent / registerEvent
   manage UI interactions with base elements
   manage performance data UI-hooks
   design autologger
   create a performance viewer
      container<output[0]/panel{input/ping/performance/reload}>:draggable,resizable
      ucb/cb >> $('container').css('width')
      page-wrap events? recode?
      performance: input/ping/performance/reload,
                   performance trend, last 200 interactions
                   show trigger processing time
                   show decryption time
                   show display time
                   running time
                   total lines/packets parsed so far
                   gmcp hover display
      coding display

  -->